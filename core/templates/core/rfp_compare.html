{% extends 'core/base.html' %}

{% block content %}
    <h1>⚖️ Vendor Comparison Matrix</h1>
    <p>AI-assisted evaluation of all received proposals.</p>

    <div class="card">
        <h3>Request Details</h3>
        <p>"{{ rfp.original_prompt }}"</p>
    </div>

    <div class="card" style="overflow-x: auto;">
        <table>
            <thead>
                <tr>
                    <th style="width: 20%;">Vendor</th>
                    <th>Total Price</th>
                    <th>Delivery</th>
                    <th>Warranty</th>
                    <th>AI Score</th>
                    <th style="width: 30%;">AI Rationale</th>
                </tr>
            </thead>
            <tbody>
                {% for p in proposals %}
                <tr>
                    <td><strong>{{ p.vendor.name }}</strong></td>
                    <td>{{ p.parsed_data.total_price }} {{ p.parsed_data.currency }}</td>
                    <td>{{ p.parsed_data.delivery_time }}</td>
                    <td>{{ p.parsed_data.warranty }}</td>
                    
                    <td>
                        {% if p.ai_score >= 80 %}
                            <span class="text-success" style="font-size: 1.2em;">{{ p.ai_score }}</span>/100
                        {% elif p.ai_score >= 50 %}
                            <span style="color: orange; font-weight: bold;">{{ p.ai_score }}</span>/100
                        {% else %}
                            <span class="text-danger">{{ p.ai_score }}</span>/100
                        {% endif %}
                    </td>
                    
                    <td style="font-size: 0.9em; color: #444;">{{ p.ai_rationale }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="text-align: center; padding: 20px;">
                        No proposals received yet. <a href="/rfp/{{ rfp.id }}/add-proposal/">Add one manually</a>.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <br>
        <a href="/" class="btn btn-secondary">← Back to Dashboard</a>
    </div>
{% endblock %}